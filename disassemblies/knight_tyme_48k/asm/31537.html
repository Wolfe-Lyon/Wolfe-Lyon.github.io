<!DOCTYPE html>
<html>
<head>
<title>Knight Tyme (48k): Routine at 31537</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../common.css" />
<link rel="stylesheet" type="text/css" href="../spectrum.css" />
<link rel="stylesheet" type="text/css" href="../knight_tyme.css" />
<script type="text/javascript" src="../js/require.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
<script type="text/javascript" src="../js/bootstrap.js"></script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="31468.html">31468</a>
</td>
<td class="up">Up: <a href="../maps/all.html#31537">Map</a></td>
<td class="next">
Next: <a href="31688.html">31688</a>
</td>
</tr>
</table>
<div class="description">31537: Process command to wear / unwear an object</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="55726.html">55726</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="address-2"><span id="31537"></span>31537</td>
<td class="instruction">LD A,11</td>
<td class="comment-1" rowspan="1">Draw window 11...</td>
</tr>
<tr>
<td class="address-1"><span id="31539"></span>31539</td>
<td class="instruction">CALL <a href="34982.html">34982</a></td>
<td class="comment-1" rowspan="1">...</td>
</tr>
<tr>
<td class="address-1"><span id="31542"></span>31542</td>
<td class="instruction">LD HL,41830</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at wear/unwear menu text...</td>
</tr>
<tr>
<td class="address-1"><span id="31545"></span>31545</td>
<td class="instruction">CALL <a href="34762.html">34762</a></td>
<td class="comment-1" rowspan="1">...and print to screen</td>
</tr>
<tr>
<td class="address-1"><span id="31548"></span>31548</td>
<td class="instruction">CALL <a href="35296.html">35296</a></td>
<td class="comment-1" rowspan="1">Process keyboard / joystick input on a menu and load <span class="register">A</span> with selected item index</td>
</tr>
<tr>
<td class="address-1"><span id="31551"></span>31551</td>
<td class="instruction">JR NZ,31627</td>
<td class="comment-1" rowspan="1">If UNWEAR selected then skip ahead to <a href="31537.html#31627">31627</a></td>
</tr>
<tr>
<td class="address-1"><span id="31553"></span>31553</td>
<td class="instruction">CALL <a href="33834.html">33834</a></td>
<td class="comment-1" rowspan="1">Display "YOU ARE NOT CARRYING ANYTHING" window and set zero flag if Magic Knight's inventory (carrying) is empty</td>
</tr>
<tr>
<td class="address-1"><span id="31556"></span>31556</td>
<td class="instruction">JP Z,<a href="29330.html#29482">29482</a></td>
<td class="comment-1" rowspan="1">If Magic Knight's inventory (carrying) is empty then return to game</td>
</tr>
<tr>
<td class="address-1"><span id="31559"></span>31559</td>
<td class="instruction">LD IX,25164</td>
<td class="comment-1" rowspan="1">Point <span class="register">IX</span> at Magic Knight's current inventory (carrying)</td>
</tr>
<tr>
<td class="address-1"><span id="31563"></span>31563</td>
<td class="instruction">LD B,5</td>
<td class="comment-1" rowspan="1">Load <span class="register">B</span> with 5 (five inventory slots)</td>
</tr>
<tr>
<td class="address-1"><span id="31565"></span>31565</td>
<td class="instruction">LD HL,41848</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at "WEAR WHICH OBJECT ?" text</td>
</tr>
<tr>
<td class="address-1"><span id="31568"></span>31568</td>
<td class="instruction">LD DE,41841</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at "WEAR THE " text</td>
</tr>
<tr>
<td class="address-1"><span id="31571"></span>31571</td>
<td class="instruction">CALL <a href="33952.html">33952</a></td>
<td class="comment-1" rowspan="1">Show list of objects in Magic Knight's inventory (carrying) as a menu and load <span class="register">A</span> with selected item index</td>
</tr>
<tr>
<td class="address-1"><span id="31574"></span>31574</td>
<td class="instruction">LD HL,25164</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at start of Magic Knight's current inventory (carrying)</td>
</tr>
<tr>
<td class="address-1"><span id="31577"></span>31577</td>
<td class="instruction">CALL <a href="33911.html">33911</a></td>
<td class="comment-1" rowspan="1">Print name of object in inventory slot <span class="register">A</span> of inventory data at <span class="register">HL</span> in command summary window</td>
</tr>
<tr>
<td class="address-1"><span id="31580"></span>31580</td>
<td class="instruction">CALL <a href="55115.html">55115</a></td>
<td class="comment-1" rowspan="1">Display execute / reject command window and return here if execute chosen, else exit to main game loop</td>
</tr>
<tr>
<td class="address-1"><span id="31583"></span>31583</td>
<td class="instruction">LD HL,25173</td>
<td class="comment-1" rowspan="1">If last slot in Magic Knight's current inventory (wearing) is not empty...</td>
</tr>
<tr>
<td class="address-1"><span id="31586"></span>31586</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">...</td>
</tr>
<tr>
<td class="address-1"><span id="31587"></span>31587</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">...</td>
</tr>
<tr>
<td class="address-1"><span id="31588"></span>31588</td>
<td class="instruction">JP NZ,<a href="55170.html">55170</a></td>
<td class="comment-1" rowspan="1">...then display "YOU ARE WEARING TOO MUCH" window (13) and return to game</td>
</tr>
<tr>
<td class="address-1"><span id="31591"></span>31591</td>
<td class="instruction">LD A,(29526)</td>
<td class="comment-1" rowspan="1">Load <span class="register">A</span> with index of Current Object</td>
</tr>
<tr>
<td class="address-1"><span id="31594"></span>31594</td>
<td class="instruction">LD E,1</td>
<td class="comment-1" rowspan="1">If object's can-be-worn flag is reset...</td>
</tr>
<tr>
<td class="address-1"><span id="31596"></span>31596</td>
<td class="instruction">CALL <a href="33525.html">33525</a></td>
<td class="comment-1" rowspan="1">...</td>
</tr>
<tr>
<td class="address-1"><span id="31599"></span>31599</td>
<td class="instruction">BIT 3,(HL)</td>
<td class="comment-1" rowspan="1">...</td>
</tr>
<tr>
<td class="address-1"><span id="31601"></span>31601</td>
<td class="instruction">JP Z,<a href="55182.html">55182</a></td>
<td class="comment-1" rowspan="1">...then display "YOU CANNOT WEAR THAT" window (13) and return to game</td>
</tr>
<tr>
<td class="address-1"><span id="31604"></span>31604</td>
<td class="instruction">LD A,(29526)</td>
<td class="comment-1" rowspan="1">Load <span class="register">C</span> with index of Current Object...</td>
</tr>
<tr>
<td class="address-1"><span id="31607"></span>31607</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">...</td>
</tr>
<tr>
<td class="address-1"><span id="31608"></span>31608</td>
<td class="instruction">LD B,5</td>
<td class="comment-1" rowspan="1">Load <span class="register">B</span> with 5 (five inventory slots)</td>
</tr>
<tr>
<td class="address-1"><span id="31610"></span>31610</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Store <span class="register">BC</span> (<span class="register">B</span> = number of slots to process, <span class="register">C</span> = Current Object)</td>
</tr>
<tr>
<td class="address-1"><span id="31611"></span>31611</td>
<td class="instruction">LD HL,25164</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at start of Magic Knight's current inventory (carrying)</td>
</tr>
<tr>
<td class="address-1"><span id="31614"></span>31614</td>
<td class="instruction">CALL <a href="36254.html">36254</a></td>
<td class="comment-1" rowspan="1">Remove object <span class="register">C</span> from this inventory</td>
</tr>
<tr>
<td class="address-1"><span id="31617"></span>31617</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> (<span class="register">B</span> = number of slots to process, <span class="register">C</span> = Current Object)</td>
</tr>
<tr>
<td class="address-1"><span id="31618"></span>31618</td>
<td class="instruction">LD HL,25169</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at Magic Knight's current inventory (wearing)...</td>
</tr>
<tr>
<td class="address-1"><span id="31621"></span>31621</td>
<td class="instruction">CALL <a href="33516.html">33516</a></td>
<td class="comment-1" rowspan="1">...and load object <span class="register">C</span> into the first empty slot</td>
</tr>
<tr>
<td class="address-1"><span id="31624"></span>31624</td>
<td class="instruction">JP <a href="29330.html#29467">29467</a></td>
<td class="comment-1" rowspan="1">Show Magic Knight's current inventory and jump back to main game loop</td>
</tr>
<tr>
<td class="address-2"><span id="31627"></span>31627</td>
<td class="instruction">CALL <a href="33824.html">33824</a></td>
<td class="comment-1" rowspan="1">Display "YOU ARE NOT WEARING ANYTHING" window and set zero flag if Magic Knight's inventory (wearing) is empty</td>
</tr>
<tr>
<td class="address-1"><span id="31630"></span>31630</td>
<td class="instruction">JP Z,<a href="29330.html#29482">29482</a></td>
<td class="comment-1" rowspan="1">If Magic Knight's inventory (wearing) is empty then return to game</td>
</tr>
<tr>
<td class="address-1"><span id="31633"></span>31633</td>
<td class="instruction">LD IX,25169</td>
<td class="comment-1" rowspan="1">Point <span class="register">IX</span> at Magic Knight's current inventory (wearing)</td>
</tr>
<tr>
<td class="address-1"><span id="31637"></span>31637</td>
<td class="instruction">LD B,5</td>
<td class="comment-1" rowspan="1">Load <span class="register">B</span> with 5 (five inventory slots)</td>
</tr>
<tr>
<td class="address-1"><span id="31639"></span>31639</td>
<td class="instruction">LD HL,41846</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at "UNWEAR WHICH OBJECT ?" text</td>
</tr>
<tr>
<td class="address-1"><span id="31642"></span>31642</td>
<td class="instruction">LD DE,41839</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at "UNWEAR THE " text</td>
</tr>
<tr>
<td class="address-1"><span id="31645"></span>31645</td>
<td class="instruction">CALL <a href="33952.html">33952</a></td>
<td class="comment-1" rowspan="1">Show list of objects in Magic Knight's inventory (wearing) as a menu and load <span class="register">A</span> with selected item index</td>
</tr>
<tr>
<td class="address-1"><span id="31648"></span>31648</td>
<td class="instruction">LD HL,25169</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at Magic Knight's current inventory (wearing)</td>
</tr>
<tr>
<td class="address-1"><span id="31651"></span>31651</td>
<td class="instruction">CALL <a href="33911.html">33911</a></td>
<td class="comment-1" rowspan="1">Print name of object in inventory slot <span class="register">A</span> of inventory data at <span class="register">HL</span> in command summary window</td>
</tr>
<tr>
<td class="address-1"><span id="31654"></span>31654</td>
<td class="instruction">CALL <a href="55115.html">55115</a></td>
<td class="comment-1" rowspan="1">Display execute / reject command window and return here if execute chosen, else exit to main game loop</td>
</tr>
<tr>
<td class="address-1"><span id="31657"></span>31657</td>
<td class="instruction">LD HL,25168</td>
<td class="comment-1" rowspan="1">Load <span class="register">A</span> with index of object in Magic Knight's fifth inventory slot (carrying)...</td>
</tr>
<tr>
<td class="address-1"><span id="31660"></span>31660</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">...</td>
</tr>
<tr>
<td class="address-1"><span id="31661"></span>31661</td>
<td class="instruction">OR A</td>
<td class="comment-1" rowspan="1">If this is not zero (i.e. Magic Knight's hands are full)...</td>
</tr>
<tr>
<td class="address-1"><span id="31662"></span>31662</td>
<td class="instruction">JP NZ,<a href="55165.html">55165</a></td>
<td class="comment-1" rowspan="1">...then display "YOUR HANDS ARE FULL" window and return to game</td>
</tr>
<tr>
<td class="address-1"><span id="31665"></span>31665</td>
<td class="instruction">LD A,(29526)</td>
<td class="comment-1" rowspan="1">Load <span class="register">C</span> with index of Current Object...</td>
</tr>
<tr>
<td class="address-1"><span id="31668"></span>31668</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">...</td>
</tr>
<tr>
<td class="address-1"><span id="31669"></span>31669</td>
<td class="instruction">LD B,5</td>
<td class="comment-1" rowspan="1">Load <span class="register">B</span> with 5 (five inventory slots)</td>
</tr>
<tr>
<td class="address-1"><span id="31671"></span>31671</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Store <span class="register">BC</span> (<span class="register">B</span> = number of slots to process, <span class="register">C</span> = Current Object)</td>
</tr>
<tr>
<td class="address-1"><span id="31672"></span>31672</td>
<td class="instruction">LD HL,25169</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at Magic Knight's current inventory (wearing)</td>
</tr>
<tr>
<td class="address-1"><span id="31675"></span>31675</td>
<td class="instruction">CALL <a href="36254.html">36254</a></td>
<td class="comment-1" rowspan="1">Remove object <span class="register">C</span> from Magic Knight's current inventory (wearing)</td>
</tr>
<tr>
<td class="address-1"><span id="31678"></span>31678</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> (<span class="register">B</span> = number of slots to process, <span class="register">C</span> = Current Object)</td>
</tr>
<tr>
<td class="address-1"><span id="31679"></span>31679</td>
<td class="instruction">LD HL,25164</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at start of Magic Knight's current inventory (carrying)...</td>
</tr>
<tr>
<td class="address-1"><span id="31682"></span>31682</td>
<td class="instruction">CALL <a href="33516.html">33516</a></td>
<td class="comment-1" rowspan="1">...and load object <span class="register">C</span> into the first empty slot</td>
</tr>
<tr>
<td class="address-1"><span id="31685"></span>31685</td>
<td class="instruction">JP <a href="29330.html#29467">29467</a></td>
<td class="comment-1" rowspan="1">Show Magic Knight's current inventory and jump back to main game loop</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="31468.html">31468</a>
</td>
<td class="up">Up: <a href="../maps/all.html#31537">Map</a></td>
<td class="next">
Next: <a href="31688.html">31688</a>
</td>
</tr>
</table>
<footer>
<div class="release">The Complete Knight Tyme (48k) RAM Disassembly 10/04/2021</div>
<div class="copyright">&#169; 1986 David Jones / Mastertronic (Knight Tyme). &#169; 2013-2021 Philip M. Anderson (this disassembly). Contact: weyoun47-AT-gmail.com.</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 8.4.</div>
</footer>
</body>
</html>