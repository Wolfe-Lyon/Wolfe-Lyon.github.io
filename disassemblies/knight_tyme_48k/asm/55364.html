<!DOCTYPE html>
<html>
<head>
<title>Knight Tyme (48k): Routine at 55364</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../spectrum.css" />
<link rel="stylesheet" type="text/css" href="../knight_tyme.css" />
<script type="text/javascript" src="../js/require.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
<script type="text/javascript" src="../js/bootstrap.js"></script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="55359.html">55359</a></span></td>
<td class="up">Up: <a href="../maps/all.html#55364">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="55401.html">55401</a></span></td>
</tr>
</table>
<div class="description">55364: Display an Information Window with Text at HL, Wait for Fire to be Pressed then Jump to Main Game Loop</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
This routine is CALLed by the instructions at <a href="30968.html#31025">31025</a>, <a href="55170.html#55173">55173</a>, <a href="55287.html">55287</a>, <a href="55291.html#55294">55294</a>, <a href="55308.html">55308</a> and <a href="55332.html#55335">55335</a>. Immediately after each of these calls is a byte of data representing the index of the window to draw. This data is read in this routine by loading the RETurn address (where the data is held) into DE and then performing a LD A,(DE).
</div>
<div class="paragraph">
There is also JP to this routine by the instruction at <a href="33952.html#34093">34093</a>, however this jump lies within a block of code that is never called - <a href="../reference/facts.html#unusedcode001">see trivia</a>.
</div>
<div class="paragraph">
Used by the routines at <a href="30968.html">30968</a>, <a href="33952.html">33952</a>, <a href="55170.html">55170</a>, <a href="55287.html">55287</a>, <a href="55291.html">55291</a>, <a href="55308.html">55308</a> and <a href="55332.html">55332</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Points to text to print in the window</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="55364"></span>55364</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">Remove value on top of stack, as we are not RETurning to this address, but reading data from it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55365"></span>55365</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Load A with window index data...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55366"></span>55366</td>
<td class="instruction">LD (55387),A</td>
<td class="comment-11" rowspan="1">...and modify instruction at <a href="55364.html#55386">55386</a> with this index</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55369"></span>55369</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Store HL (pointer to text to print)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55370"></span>55370</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1">Load eight times window index into HL...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55371"></span>55371</td>
<td class="instruction">LD H,0</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55373"></span>55373</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55374"></span>55374</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55375"></span>55375</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55376"></span>55376</td>
<td class="instruction">LD DE,37091</td>
<td class="comment-11" rowspan="1">Point DE at y-coordinate of top of window in first entry of Window Data table at <a href="37089.html">37089</a>...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55379"></span>55379</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1">...and add HL as offset in HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55380"></span>55380</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Swap DE (now points to y-coordinate of top of required window) and HL (now points to first entry in Window Data table)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55381"></span>55381</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore HL (pointer to text to print)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55382"></span>55382</td>
<td class="instruction">CALL <a href="33774.html">33774</a></td>
<td class="comment-11" rowspan="1">Adjust height of window to accommodate text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55385"></span>55385</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Store HL (pointer to start of text data)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="55386"></span>
<div class="comments">
<div class="paragraph">
The operand of the instruction at <a href="55364.html#55386">55386</a> represents a window index. This is modified by the instruction at <a href="55364.html#55366">55366</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55386"></span>55386</td>
<td class="instruction">LD A,0</td>
<td class="comment-11" rowspan="1">Draw window with index specified in data previously...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55388"></span>55388</td>
<td class="instruction">CALL <a href="34990.html">34990</a></td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55391"></span>55391</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore HL (pointer to start of text data)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55392"></span>55392</td>
<td class="instruction">CALL <a href="34762.html">34762</a></td>
<td class="comment-11" rowspan="1">Print text to screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55395"></span>55395</td>
<td class="instruction">CALL <a href="55138.html">55138</a></td>
<td class="comment-11" rowspan="1">Display "PRESS FIRE TO CONTINUE" Window and wait for fire to be pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="55398"></span>55398</td>
<td class="instruction">JP <a href="29330.html#29482">29482</a></td>
<td class="comment-11" rowspan="1">Set Magic Knight's available action flags, validate I.D. Card if appropriate and jump to start of Main Game Loop</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="55359.html">55359</a></span></td>
<td class="up">Up: <a href="../maps/all.html#55364">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="55401.html">55401</a></span></td>
</tr>
</table>
<footer>
<div class="release">The Complete Knight Tyme (48k) RAM Disassembly 02/06/2018</div>
<div class="copyright">&#169; 1986 David Jones / Mastertronic (Knight Tyme). &#169; 2017 Philip M. Anderson (this disassembly). Contact: weyoun47-AT-gmail.com.</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 6.4.</div>
</footer>
</body>
</html>