<!DOCTYPE html>
<html>
<head>
<title>Knight Tyme (48k): Routine at 35649</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../spectrum.css" />
<link rel="stylesheet" type="text/css" href="../knight_tyme.css" />
<script type="text/javascript" src="../js/require.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
<script type="text/javascript" src="../js/bootstrap.js"></script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="35627.html">35627</a></span></td>
<td class="up">Up: <a href="../maps/all.html#35649">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="35674.html">35674</a></span></td>
</tr>
</table>
<div class="description">35649: Clear Display File</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
When this routine is entered via <a href="35649.html">35649</a> and <a href="35649.html#35656">35656</a>, B is set to zero. Upon reaching the DJNZ instruction (end of inner loop) at <a href="35649.html#35664">35664</a>, B is already zero, so the loop will execute 256 times, clearing one twelfth of the Display File (two bytes cleared per PUSH, 256 PUSHes per loop).
</div>
<div class="paragraph">
However when entering via <a href="35649.html#35663">35663</a> (jump at <a href="28716.html#28727">28727</a>), HL is set 23264 (second last character in second last row of Attribute File) and BC is set to 4098 (B = 16, C = 2). This means that the first iteration of the inner loop will only clear 32 bytes (i.e. 23rd character row) in the Attribute File. The outer loop will, however, execute twice. Upon second iteration of outer loop, B is zero (as it was at the end of the first outer loop's inner loop), so the inner loop will this time execute 256 times, clearing the 22nd to the 7th (inclusive) character rows.
</div>
<div class="paragraph">
Used by the routine at <a href="26884.html">26884</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35649"></span>35649</td>
<td class="instruction">LD HL,0</td>
<td class="comment-11" rowspan="1">Load zero (all bits reset) into HL</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35652"></span>35652</td>
<td class="instruction">LD BC,12</td>
<td class="comment-11" rowspan="1">Load B with 0 (repeat inner loop 256 times) and C with 12 (repeat outer loop 12 times)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35655"></span>35655</td>
<td class="instruction">DI</td>
<td class="comment-11" rowspan="1">Disable interrupts</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="35656"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="35627.html">35627</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35656"></span>35656</td>
<td class="instruction">LD (35670),SP</td>
<td class="comment-11" rowspan="1">Store stack pointer at <a href="35649.html#35669">35670</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35660"></span>35660</td>
<td class="instruction">LD SP,22528</td>
<td class="comment-11" rowspan="1">Point stack pointer at start of attribute section of video memory</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="35663"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="28716.html">28716</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="35663"></span>35663</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Decrease current stack pointer position by two and load two zeroes into it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35664"></span>35664</td>
<td class="instruction">DJNZ 35663</td>
<td class="comment-11" rowspan="1">Loop back for next iteration</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35666"></span>35666</td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="1">Decrease C...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35667"></span>35667</td>
<td class="instruction">JR NZ,35663</td>
<td class="comment-11" rowspan="1">...and repeat if C is still greater than zero, to clear the remaining eleven twelfths of the Display File</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35669"></span>35669</td>
<td class="instruction">LD SP,0</td>
<td class="comment-11" rowspan="1">Restore stack pointer to original value [Operand set by instructions at <a href="28716.html#28717">28717</a> and <a href="35649.html#35656">35656</a>]</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35672"></span>35672</td>
<td class="instruction">EI</td>
<td class="comment-11" rowspan="1">Enable interrupts</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="35673"></span>35673</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Return</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="35627.html">35627</a></span></td>
<td class="up">Up: <a href="../maps/all.html#35649">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="35674.html">35674</a></span></td>
</tr>
</table>
<footer>
<div class="release">The Complete Knight Tyme (48k) RAM Disassembly 02/06/2018</div>
<div class="copyright">&#169; 1986 David Jones / Mastertronic (Knight Tyme). &#169; 2017 Philip M. Anderson (this disassembly). Contact: weyoun47-AT-gmail.com.</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 6.4.</div>
</footer>
</body>
</html>