<!DOCTYPE html>
<html>
<head>
<title>Knight Tyme (48k): Routine at 34627</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../spectrum.css" />
<link rel="stylesheet" type="text/css" href="../knight_tyme.css" />
<script type="text/javascript" src="../js/require.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
<script type="text/javascript" src="../js/bootstrap.js"></script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="34567.html">34567</a></span></td>
<td class="up">Up: <a href="../maps/all.html#34627">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="34697.html">34697</a></span></td>
</tr>
</table>
<div class="description">34627: Draw Objects in Magic Knight's Inventory if he is Carrying the Mirror</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="27703.html">27703</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="34627"></span>34627</td>
<td class="instruction">LD A,35</td>
<td class="comment-11" rowspan="1">If Magic Knight is not carrying the Mirror (35)...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34629"></span>34629</td>
<td class="instruction">CALL <a href="33645.html">33645</a></td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34632"></span>34632</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">...then return</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34633"></span>34633</td>
<td class="instruction">LD HL,25164</td>
<td class="comment-11" rowspan="1">Point HL at start of Magic Knight's current inventory (carrying)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34636"></span>34636</td>
<td class="instruction">LD B,5</td>
<td class="comment-11" rowspan="1">Load B with 5 (five inventory slots)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34638"></span>34638</td>
<td class="instruction">LD DE,784</td>
<td class="comment-11" rowspan="1">Load DE with x- and y-coordinates respectively to start drawing object graphics (D, or x = 3, E, or y = 16)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="34641"></span>34641</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Store BC (B = remaining number of inventory slots to process)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34642"></span>34642</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Store HL (pointer to current position in Magic Knight's current inventory)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34643"></span>34643</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1">Store DE (coordinates in characters to draw object)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34644"></span>34644</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Load index of object in current slot in Magic Knight's inventory into A</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34645"></span>34645</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">If this is zero...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34646"></span>34646</td>
<td class="instruction">JR Z,34693</td>
<td class="comment-11" rowspan="1">...then restore registers and return</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34648"></span>34648</td>
<td class="instruction">LD E,6</td>
<td class="comment-11" rowspan="1">Load 6 (index of objects' attribute property) into E</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34650"></span>34650</td>
<td class="instruction">CALL <a href="33525.html">33525</a></td>
<td class="comment-11" rowspan="1">Point HL at the attribute property of the object in the current inventory slot</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34653"></span>34653</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Load attribute into ATTR T system variable...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34654"></span>34654</td>
<td class="instruction">LD (23695),A</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34657"></span>34657</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Advance HL to point to graphic index property...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34658"></span>34658</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">...and load into A</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34659"></span>34659</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore BC (coordinates in characters to draw object, was in DE)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34660"></span>34660</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Store BC (coordinates in characters to draw object)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34661"></span>34661</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Store BC (coordinates in characters to draw object)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34662"></span>34662</td>
<td class="instruction">CALL <a href="54406.html">54406</a></td>
<td class="comment-11" rowspan="1">Draw an object with lookup index A at character coordinates (C, B)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34665"></span>34665</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore BC (coordinates in characters to draw object)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34666"></span>34666</td>
<td class="instruction">CALL <a href="54148.html">54148</a></td>
<td class="comment-11" rowspan="1">Load HL with Attribute File address for coordinates (C, B)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34669"></span>34669</td>
<td class="instruction">LD A,(23695)</td>
<td class="comment-11" rowspan="1">Load A with value stored in ATTR T system variable...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34672"></span>34672</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">...and apply this attribute to Attribute File at coordinates (C, B)...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34673"></span>34673</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34674"></span>34674</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">...(C + 1, B)...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34675"></span>34675</td>
<td class="instruction">LD BC,31</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34678"></span>34678</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34679"></span>34679</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">...(C, B + 1)...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34680"></span>34680</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34681"></span>34681</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">...and (C + 1, B + 1)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34682"></span>34682</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">Restore DE (coordinates in characters to draw object)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34683"></span>34683</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1">Advance right by three characters (i.e. add three to x-coordinate in E)...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34684"></span>34684</td>
<td class="instruction">ADD A,3</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34686"></span>34686</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34687"></span>34687</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore HL (pointer to current position in Magic Knight's current inventory)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34688"></span>34688</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Advance HL to next inventory slot</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34689"></span>34689</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore BC (B = remaining number of inventory slots to process)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34690"></span>34690</td>
<td class="instruction">DJNZ 34641</td>
<td class="comment-11" rowspan="1">Decrease B, and loop back to <a href="34627.html#34641">34641</a> if not zero</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34692"></span>34692</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Return</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="34693"></span>34693</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">Restore DE (coordinates in characters to draw object)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34694"></span>34694</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore HL (pointer to current position in Magic Knight's current inventory)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34695"></span>34695</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore BC (B = remaining number of inventory slots to process)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="34696"></span>34696</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Return</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="34567.html">34567</a></span></td>
<td class="up">Up: <a href="../maps/all.html#34627">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="34697.html">34697</a></span></td>
</tr>
</table>
<footer>
<div class="release">The Complete Knight Tyme (48k) RAM Disassembly 02/06/2018</div>
<div class="copyright">&#169; 1986 David Jones / Mastertronic (Knight Tyme). &#169; 2017 Philip M. Anderson (this disassembly). Contact: weyoun47-AT-gmail.com.</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 6.4.</div>
</footer>
</body>
</html>