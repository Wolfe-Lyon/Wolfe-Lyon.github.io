<!DOCTYPE html>
<html>
<head>
<title>Spellbound (48k): Routine at 30540</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../spectrum.css" />
<link rel="stylesheet" type="text/css" href="../spellbound.css" />
<script type="text/javascript" src="../js/require.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
<script type="text/javascript" src="../js/bootstrap.js"></script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="30439.html">30439</a></span></td>
<td class="up">Up: <a href="../maps/all.html#30540">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="30602.html">30602</a></span></td>
</tr>
</table>
<div class="description">30540: Smash Glowing Bottle</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="30439.html">30439</a> and <a href="32390.html">32390</a>.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">C</td>
<td class="register-desc">16 (Item index of Glowing Bottle)</td>
</tr>
</table>
<table class="output-1">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">C</td>
<td class="register-desc">14 (Item index of Broken Glass)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30540"></span>30540</td>
<td class="instruction">LD C,16</td>
<td class="comment-11" rowspan="1">Remove Glowing Bottle from Magic Knight's inventory...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30542"></span>30542</td>
<td class="instruction">LD B,5</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30544"></span>30544</td>
<td class="instruction">LD HL,25395</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30547"></span>30547</td>
<td class="instruction">CALL <a href="38674.html">38674</a></td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30550"></span>30550</td>
<td class="instruction">LD HL,45496</td>
<td class="comment-11" rowspan="1">Display "YOU DROPPED THE BOTTLE TO THE GROUND..." window (window 26)...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30553"></span>30553</td>
<td class="instruction">LD A,26</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30555"></span>30555</td>
<td class="instruction">CALL <a href="36987.html">36987</a></td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30558"></span>30558</td>
<td class="instruction">LD HL,45496</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30561"></span>30561</td>
<td class="instruction">CALL <a href="36725.html">36725</a></td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30564"></span>30564</td>
<td class="instruction">LD A,(23467)</td>
<td class="comment-11" rowspan="1">Set "Banshee is released" flag...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30567"></span>30567</td>
<td class="instruction">SET 0,A</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30569"></span>30569</td>
<td class="instruction">LD (23467),A</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30572"></span>30572</td>
<td class="instruction">CALL <a href="38749.html">38749</a></td>
<td class="comment-11" rowspan="1">Display "PRESS SPACE OR FIRE TO CONTINUE" window and wait for space / fire</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30575"></span>30575</td>
<td class="instruction">LD B,7</td>
<td class="comment-11" rowspan="1">Set B to 7 (index of Banshee)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30577"></span>30577</td>
<td class="instruction">LD A,(65529)</td>
<td class="comment-11" rowspan="1">Load A with Magic Knight's current room...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30580"></span>30580</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">...and copy into C</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30581"></span>30581</td>
<td class="instruction">CALL <a href="36327.html">36327</a></td>
<td class="comment-11" rowspan="1">Assign a slot in room C to character B and get x- and y-coordinates in BC</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30584"></span>30584</td>
<td class="instruction">CP 4</td>
<td class="comment-11" rowspan="1">If assigned slot number is 4 (i.e. already three characters in current room)...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30586"></span>30586</td>
<td class="instruction">JR Z,30599</td>
<td class="comment-11" rowspan="1">...then skip ahead to <a href="30540.html#30599">30599</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30588"></span>30588</td>
<td class="instruction">LD HL,25461</td>
<td class="comment-11" rowspan="1">Point HL at Banshee's current location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30591"></span>30591</td>
<td class="instruction">LD A,(65529)</td>
<td class="comment-11" rowspan="1">Load Magic Knight's current room index into A</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30594"></span>30594</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Set Banshee's current room as Magic Knight's current room</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30595"></span>30595</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point HL at Banshee's current x-coordinate...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30596"></span>30596</td>
<td class="instruction">LD (HL),C</td>
<td class="comment-11" rowspan="1">...and set to match assigned slot</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30597"></span>30597</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point HL at Banshee's current y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30598"></span>30598</td>
<td class="instruction">LD (HL),B</td>
<td class="comment-11" rowspan="1">...and set to match assigned slot</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="30599"></span>30599</td>
<td class="instruction">LD C,14</td>
<td class="comment-11" rowspan="1">Load C with index of Broken Glass (as this will be replacing the Glowing Bottle in the world)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="30601"></span>30601</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Return</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="30439.html">30439</a></span></td>
<td class="up">Up: <a href="../maps/all.html#30540">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="30602.html">30602</a></span></td>
</tr>
</table>
<footer>
<div class="release">The Complete Spellbound (48k) RAM Disassembly 02/06/2018</div>
<div class="copyright">&#169; 1985 David Jones / Mastertronic (Spellbound). &#169; 2017 Philip M. Anderson (this disassembly). Contact: weyoun47-AT-gmail.com.</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 6.4.</div>
</footer>
</body>
</html>