<!DOCTYPE html>
<html>
<head>
<title>Stormbringer (48k): Routine at 44337</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../spectrum.css" />
<link rel="stylesheet" type="text/css" href="../stormbringer.css" />
<script type="text/javascript" src="../js/require.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
<script type="text/javascript" src="../js/bootstrap.js"></script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="44253.html">44253</a></span></td>
<td class="up">Up: <a href="../maps/all.html#44337">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="44615.html">44615</a></span></td>
</tr>
</table>
<div class="description">44337: Process Command to Blow an Object</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">

</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="44337"></span>44337</td>
<td class="instruction">LD IX,24848</td>
<td class="comment-11" rowspan="1">Point IX at start of Magic Knight's current inventory (carrying)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44341"></span>44341</td>
<td class="instruction">LD B,5</td>
<td class="comment-11" rowspan="1">Load B with 5 (five inventory slots)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44343"></span>44343</td>
<td class="instruction">LD HL,51920</td>
<td class="comment-11" rowspan="1">Point HL at "[Current Command] WHICH OBJECT ?" text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44346"></span>44346</td>
<td class="instruction">LD DE,51928</td>
<td class="comment-11" rowspan="1">Point DE at "[Current Command] THE " text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44349"></span>44349</td>
<td class="instruction">CALL <a href="45809.html">45809</a></td>
<td class="comment-11" rowspan="1">Show list of objects in Magic Knight's inventory (carrying) as a menu and load A with selected item index</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44352"></span>44352</td>
<td class="instruction">LD HL,24848</td>
<td class="comment-11" rowspan="1">Point HL at start of Magic Knight's current inventory (carrying)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44355"></span>44355</td>
<td class="instruction">CALL <a href="45766.html">45766</a></td>
<td class="comment-11" rowspan="1">Print name of selected object in Magic Knight's current inventory (carrying) in Command Summary Window</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44358"></span>44358</td>
<td class="instruction">LD A,(41779)</td>
<td class="comment-11" rowspan="1">Load A with index of Current Object</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44361"></span>44361</td>
<td class="instruction">CP 22</td>
<td class="comment-11" rowspan="1">If the selected object is not the Elf-Horn...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44363"></span>44363</td>
<td class="instruction">JP NZ,44557</td>
<td class="comment-11" rowspan="1">...then skip ahead to <a href="44337.html#44557">44557</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44366"></span>44366</td>
<td class="instruction">LD A,(23702)</td>
<td class="comment-11" rowspan="1">Load BC with double index of Magic Knight's current room...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44369"></span>44369</td>
<td class="instruction">ADD A,A</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44370"></span>44370</td>
<td class="instruction">LD C,A</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44371"></span>44371</td>
<td class="instruction">LD B,0</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44373"></span>44373</td>
<td class="instruction">LD HL,48915</td>
<td class="comment-11" rowspan="1">Load HL with start address of Character Movement Restriction Data</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44376"></span>44376</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-11" rowspan="1">Add BC as offset</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44377"></span>44377</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Load current room's movement restriction data...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44378"></span>44378</td>
<td class="instruction">LD (44454),A</td>
<td class="comment-11" rowspan="1">...into operand of instruction at <a href="44337.html#44453">44453</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44381"></span>44381</td>
<td class="instruction">CALL <a href="63399.html">63399</a></td>
<td class="comment-11" rowspan="1">Print or update Command Summary Window at top of Screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44384"></span>44384</td>
<td class="instruction">LD DE,56163</td>
<td class="comment-11" rowspan="1">Point DE at "SUMMON " text...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44387"></span>44387</td>
<td class="instruction">CALL <a href="63349.html">63349</a></td>
<td class="comment-11" rowspan="1">...and print in Command Summary Window at top of screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44390"></span>44390</td>
<td class="instruction">LD HL,51413</td>
<td class="comment-11" rowspan="1">Point HL at "SUMMON ?" text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44393"></span>44393</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Store HL (address of "SUMMON ?" text)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44394"></span>44394</td>
<td class="instruction">LD HL,48598</td>
<td class="comment-11" rowspan="1">Load HL with start address of list of characters for "SUMMON" Character Selection Menu</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44397"></span>44397</td>
<td class="instruction">CALL <a href="46106.html">46106</a></td>
<td class="comment-11" rowspan="1">Display and process input for character selection menu ("SUMMON")</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44400"></span>44400</td>
<td class="instruction">CALL <a href="64207.html">64207</a></td>
<td class="comment-11" rowspan="1">Display Execute / Reject Command window and return here if Execute chosen, else exit to Main Game Loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44403"></span>44403</td>
<td class="instruction">LD A,(41779)</td>
<td class="comment-11" rowspan="1">Load A with index of Current Object (<a href="../reference/facts.html#redundantinstructions">see trivia</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44406"></span>44406</td>
<td class="instruction">CALL <a href="45601.html">45601</a></td>
<td class="comment-11" rowspan="1">Point HL at current position data for Current Character</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44409"></span>44409</td>
<td class="instruction">LD A,(23702)</td>
<td class="comment-11" rowspan="1">Load A with Magic Knight's current room...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44412"></span>44412</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">...and set Zero Flag if this is the same as the Current Character's current room</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44413"></span>44413</td>
<td class="instruction">LD HL,56275</td>
<td class="comment-11" rowspan="1">Point HL at "[Current Character's full name] IS ALREADY HERE!" text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44416"></span>44416</td>
<td class="instruction">JP Z,<a href="64309.html">64309</a></td>
<td class="comment-11" rowspan="1">If Zero Flag is set then display "[Character] IS ALREADY HERE!" Window (28), wait for Fire to be pressed then jump to Main Game Loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44419"></span>44419</td>
<td class="instruction">LD A,(41937)</td>
<td class="comment-11" rowspan="1">Point HL at Current Character's strength...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44422"></span>44422</td>
<td class="instruction">LD E,0</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44424"></span>44424</td>
<td class="instruction">CALL <a href="45406.html">45406</a></td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44427"></span>44427</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Load IX with address of Current Character's strength...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44428"></span>44428</td>
<td class="instruction">POP IX</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44430"></span>44430</td>
<td class="instruction">BIT 7,(IX+6)</td>
<td class="comment-11" rowspan="1">Set Zero Flag to inverse of Current Character's Asleep Flag (i.e. Awake Flag)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44434"></span>44434</td>
<td class="instruction">LD HL,56213</td>
<td class="comment-11" rowspan="1">Point HL at "[Current Character's full name] IS ASLEEP" text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44437"></span>44437</td>
<td class="instruction">JP NZ,<a href="64309.html">64309</a></td>
<td class="comment-11" rowspan="1">If Zero Flag is not set then display "[Character] IS ASLEEP" Window (28), wait for Fire to be pressed then jump to Main Game Loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44440"></span>44440</td>
<td class="instruction">LD A,(IX+1)</td>
<td class="comment-11" rowspan="1">If character's happiness is less than 35...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44443"></span>44443</td>
<td class="instruction">AND 127</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44445"></span>44445</td>
<td class="instruction">CP 35</td>
<td class="comment-11" rowspan="1">...then set Carry Flag</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44447"></span>44447</td>
<td class="instruction">LD HL,56224</td>
<td class="comment-11" rowspan="1">Point HL at "[Current Character's full name] DOES NOT WANT TO BE SUMMONED" text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44450"></span>44450</td>
<td class="instruction">JP C,<a href="64309.html">64309</a></td>
<td class="comment-11" rowspan="1">If Carry Flag is set then display "[Character] DOES NOT WANT TO BE SUMMONED" Window (28), wait for Fire to be pressed then jump to Main Game Loop</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="44453"></span>
<div class="comments">
<div class="paragraph">
The operand of the instruction at <a href="44337.html#44453">44453</a> represents the movement restriction data for the current room. This is modified by the instruction at <a href="44337.html#44378">44378</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44453"></span>44453</td>
<td class="instruction">LD A,0</td>
<td class="comment-11" rowspan="1">If movement restriction data is 98 (i.e. room not accessible by character)...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44455"></span>44455</td>
<td class="instruction">CP 98</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44457"></span>44457</td>
<td class="instruction">JP Z,<a href="64309.html">64309</a></td>
<td class="comment-11" rowspan="1">...then display "[Character] DOES NOT WANT TO BE SUMMONED" Window (28), wait for Fire to be pressed then jump to Main Game Loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44460"></span>44460</td>
<td class="instruction">LD A,(IX+2)</td>
<td class="comment-11" rowspan="1">If Current Character's stamina is less than 25...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44463"></span>44463</td>
<td class="instruction">AND 127</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44465"></span>44465</td>
<td class="instruction">CP 25</td>
<td class="comment-11" rowspan="1">...then set Carry Flag</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44467"></span>44467</td>
<td class="instruction">LD HL,56248</td>
<td class="comment-11" rowspan="1">Point HL at "[Current Character's full name] IS TOO TIRED TO BE SUMMONED" text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44470"></span>44470</td>
<td class="instruction">JP C,<a href="64309.html">64309</a></td>
<td class="comment-11" rowspan="1">If Carry Flag is set then display "[Character] IS TOO TIRED TO BE SUMMONED" Window (28), wait for Fire to be pressed then jump to Main Game Loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44473"></span>44473</td>
<td class="instruction">CALL <a href="45601.html">45601</a></td>
<td class="comment-11" rowspan="1">Point HL at current position data for Current Character</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44476"></span>44476</td>
<td class="instruction">CALL <a href="44615.html">44615</a></td>
<td class="comment-11" rowspan="1">Load BC with coordinates of character's arrival point when summoned to current room and set Zero Flag if character refuses to come</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44479"></span>44479</td>
<td class="instruction">JP Z,44585</td>
<td class="comment-11" rowspan="1">If character does not want to come here then skip ahead to <a href="44337.html#44585">44585</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44482"></span>44482</td>
<td class="instruction">LD A,(24840)</td>
<td class="comment-11" rowspan="1">Load A with Magic Knight's current x-coordinate (characters)...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44485"></span>44485</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44486"></span>44486</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44487"></span>44487</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44488"></span>44488</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44490"></span>44490</td>
<td class="instruction">SUB C</td>
<td class="comment-11" rowspan="1">Subtract arrival x-coordinate to give horizontal distance from Magic Knight...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44491"></span>44491</td>
<td class="instruction">JP Z,44591</td>
<td class="comment-11" rowspan="1">...and if zero then skip ahead to <a href="44337.html#44591">44591</a> (check vertical distance to Magic Knight)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44494"></span>44494</td>
<td class="instruction">CP 1</td>
<td class="comment-11" rowspan="1">If horizontal distance is 1...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44496"></span>44496</td>
<td class="instruction">JP Z,44591</td>
<td class="comment-11" rowspan="1">...then skip ahead to <a href="44337.html#44591">44591</a> (check vertical distance to Magic Knight)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44499"></span>44499</td>
<td class="instruction">CP 255</td>
<td class="comment-11" rowspan="1">If horizontal distance is -1...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44501"></span>44501</td>
<td class="instruction">JP Z,44591</td>
<td class="comment-11" rowspan="1">...then skip ahead to <a href="44337.html#44591">44591</a> (check vertical distance to Magic Knight)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44504"></span>44504</td>
<td class="instruction">CP 254</td>
<td class="comment-11" rowspan="1">If horizontal distance is -2...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44506"></span>44506</td>
<td class="instruction">JP Z,44591</td>
<td class="comment-11" rowspan="1">...then skip ahead to <a href="44337.html#44591">44591</a> (check vertical distance to Magic Knight)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="44509"></span>
<div class="comments">
<div class="paragraph">
Have character arrive in new room
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="44509"></span>44509</td>
<td class="instruction">LD A,(23702)</td>
<td class="comment-11" rowspan="1">Load A with index of Magic Knight's current room...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44512"></span>44512</td>
<td class="instruction">OR 128</td>
<td class="comment-11" rowspan="1">...and set MSB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44514"></span>44514</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Set this as character's current room</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44515"></span>44515</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Advance to character's x-coordinate...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44516"></span>44516</td>
<td class="instruction">LD (HL),C</td>
<td class="comment-11" rowspan="1">...and set to value in C</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44517"></span>44517</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Advance to character's y-coordinate...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44518"></span>44518</td>
<td class="instruction">LD (HL),B</td>
<td class="comment-11" rowspan="1">...and set to value in B</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44519"></span>44519</td>
<td class="instruction">LD A,(IX+0)</td>
<td class="comment-11" rowspan="1">Decrease character's strength by 4...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44522"></span>44522</td>
<td class="instruction">SUB 4</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44524"></span>44524</td>
<td class="instruction">LD (IX+0),A</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44527"></span>44527</td>
<td class="instruction">LD A,(IX+1)</td>
<td class="comment-11" rowspan="1">Decrease character's happiness by 3...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44530"></span>44530</td>
<td class="instruction">SUB 3</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44532"></span>44532</td>
<td class="instruction">LD (IX+1),A</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44535"></span>44535</td>
<td class="instruction">LD A,(IX+2)</td>
<td class="comment-11" rowspan="1">Decrease character's stamina by 7...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44538"></span>44538</td>
<td class="instruction">SUB 7</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44540"></span>44540</td>
<td class="instruction">LD (IX+2),A</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44543"></span>44543</td>
<td class="instruction">LD A,(24771)</td>
<td class="comment-11" rowspan="1">Decrease Magic Knight's current magic level by 3...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44546"></span>44546</td>
<td class="instruction">SUB 3</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44548"></span>44548</td>
<td class="instruction">LD (24771),A</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44551"></span>44551</td>
<td class="instruction">LD HL,56347</td>
<td class="comment-11" rowspan="1">Point HL at "[Current Character's full name] APPEARS IN A THICK PUFF OF SMOKE" text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44554"></span>44554</td>
<td class="instruction">JP <a href="64309.html">64309</a></td>
<td class="comment-11" rowspan="1">Display "[Character] APPEARS IN A THICK PUFF OF SMOKE" Window (28), wait for Fire to be pressed then jump to Main Game Loop</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="44557"></span>
<div class="comments">
<div class="paragraph">
Blown object is not the Elf-Horn
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="44557"></span>44557</td>
<td class="instruction">CALL <a href="64207.html">64207</a></td>
<td class="comment-11" rowspan="1">Display Execute / Reject Command window and return here if Execute chosen, else exit to Main Game Loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44560"></span>44560</td>
<td class="instruction">LD A,(41779)</td>
<td class="comment-11" rowspan="1">Load A with index of Current Object...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44563"></span>44563</td>
<td class="instruction">CALL <a href="45685.html">45685</a></td>
<td class="comment-11" rowspan="1">...and if this is 4 (Teddy Bear) then display "THE BEAR SAYS..." message and wait for Fire to be pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44566"></span>44566</td>
<td class="instruction">LD E,0</td>
<td class="comment-11" rowspan="1">Load E with 0 (prepare to check Blow Status Flag)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44568"></span>44568</td>
<td class="instruction">CALL <a href="45390.html">45390</a></td>
<td class="comment-11" rowspan="1">Point HL to byte 0 of the A-th record in Object Properties Table</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44571"></span>44571</td>
<td class="instruction">BIT 6,(HL)</td>
<td class="comment-11" rowspan="1">Set Zero Flag if object's Blow Status Flag is reset, otherwise reset</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44573"></span>44573</td>
<td class="instruction">LD HL,56304</td>
<td class="comment-11" rowspan="1">Point HL at "WHAT A LOT OF DUST..." text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44576"></span>44576</td>
<td class="instruction">JP Z,<a href="64305.html">64305</a></td>
<td class="comment-11" rowspan="1">If Zero Flag is set then display "WHAT A LOT OF DUST..." Window (27), wait for Fire to be pressed then jump to Main Game Loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44579"></span>44579</td>
<td class="instruction">LD HL,56165</td>
<td class="comment-11" rowspan="1">Point HL at "I THINK YOU SHOULD GIVE UP TRYING TO PLAY THE [name of Current Object]..." text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44582"></span>44582</td>
<td class="instruction">JP <a href="64305.html">64305</a></td>
<td class="comment-11" rowspan="1">Display "I THINK YOU SHOULD GIVE UP..." Window (27), wait for Fire to be pressed then jump to Main Game Loop</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="44585"></span>
<div class="comments">
<div class="paragraph">
Character does not want to come to current room
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="44585"></span>44585</td>
<td class="instruction">LD HL,56284</td>
<td class="comment-11" rowspan="1">Point HL at "[Current Character's short name] DOES NOT WANT TO COME HERE!" text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44588"></span>44588</td>
<td class="instruction">JP <a href="64305.html">64305</a></td>
<td class="comment-11" rowspan="1">Display "[Character] DOES NOT WANT TO COME HERE!" Window (27), wait for Fire to be pressed then jump to Main Game Loop</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="44591"></span>
<div class="comments">
<div class="paragraph">
Magic Knight is within two characters horizontally of character's intended arrival point
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="44591"></span>44591</td>
<td class="instruction">LD A,(24841)</td>
<td class="comment-11" rowspan="1">Load A with Magic Knight's current y-coordinate (characters)...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44594"></span>44594</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44595"></span>44595</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44596"></span>44596</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44597"></span>44597</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="1">...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44599"></span>44599</td>
<td class="instruction">SUB B</td>
<td class="comment-11" rowspan="1">Subtract arrival y-coordinate to give vertical distance from Magic Knight...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44600"></span>44600</td>
<td class="instruction">AND 252</td>
<td class="comment-11" rowspan="1">If bits 2-7 are all reset (i.e. distance was 0 - 3)...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44602"></span>44602</td>
<td class="instruction">JR Z,44609</td>
<td class="comment-11" rowspan="1">...then skip ahead to <a href="44337.html#44609">44609</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44604"></span>44604</td>
<td class="instruction">CP 252</td>
<td class="comment-11" rowspan="1">If bits 2-7 are not all set (i.e. distance was not -1 - -4)...</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44606"></span>44606</td>
<td class="instruction">JP NZ,44509</td>
<td class="comment-11" rowspan="1">...then jump back to <a href="44337.html#44509">44509</a> (have character arrive)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="44609"></span>44609</td>
<td class="instruction">LD HL,56070</td>
<td class="comment-11" rowspan="1">Point HL at "[Current Character's short name] SAYS 'I CANNOT COME TO THAT ROOM ... YOU ARE IN MY WAY!'" text</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="44612"></span>44612</td>
<td class="instruction">JP <a href="64290.html#64293">64293</a></td>
<td class="comment-11" rowspan="1">Display "[Character] SAYS 'I CANNOT COME TO THAT ROOM...'" Window (15), wait for Fire to be pressed then jump to Main Game Loop</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="44253.html">44253</a></span></td>
<td class="up">Up: <a href="../maps/all.html#44337">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="44615.html">44615</a></span></td>
</tr>
</table>
<footer>
<div class="release">The Complete Stormbringer (48k) RAM Disassembly 02/06/2018</div>
<div class="copyright">&#169; 1987 David Jones / Mastertronic (Stormbringer). &#169; 2017 Philip M. Anderson (this disassembly). Contact: weyoun47-AT-gmail.com.</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 6.4.</div>
</footer>
</body>
</html>